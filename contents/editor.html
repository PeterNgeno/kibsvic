<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Your Page</title>
  <link rel="stylesheet" href="style.css">
  <style>
    img.preview {
      margin-top: 10px;
      max-width: 100%;
      max-height: 300px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h2>Customize Your Page</h2>

  <label>Title: <input type="text" id="titleInput"></label><br>
  <label>Description:<br>
    <textarea id="descInput" rows="4" cols="50"></textarea>
  </label><br>

  <label>Choose Font:
    <select id="fontSelect">
      <option>Arial</option>
      <option>Georgia</option>
      <option>Courier New</option>
    </select>
  </label><br>

  <label>Text Color: <input type="color" id="textColorInput"></label><br>
  <label>Background Color: <input type="color" id="bgColorInput"></label><br>

  <label>Animation:
    <select id="animationSelect">
      <option value="none">None</option>
      <option value="fadeIn">Fade In</option>
      <option value="slideIn">Slide In</option>
    </select>
  </label><br><br>

  <label>Paste Image Link: <input type="url" id="imgLinkInput" placeholder="https://drive.google.com/..."></label><br>
  <label>Or Upload Image: <input type="file" accept="image/*" id="imageUploader" onchange="previewImage(event)"></label><br><img id="imagePreview" class="preview" style="display:none;"><br>

  <label>Paste Video Link: <input type="url" id="videoLinkInput" placeholder="https://youtu.be/..."></label><br><br>

  <button onclick="savePage()">Save Page</button>

<script>
  function previewImage(event) {
    const f = event.target.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = e => {
      document.getElementById("imagePreview").src = e.target.result;
      document.getElementById("imagePreview").style.display = "block";
      document.getElementById("imgLinkInput").value = e.target.result;
    };
    r.readAsDataURL(f);
  }

  async function savePage() {
    const title = document.getElementById("titleInput").value.trim();
    if (!title) { alert("Please enter a title"); return; }
    const desc = document.getElementById("descInput").value || "";
    const font = document.getElementById("fontSelect").value;
    const color = document.getElementById("textColorInput").value;
    const bgColor = document.getElementById("bgColorInput").value;
    const anim = document.getElementById("animationSelect").value;
    const image = document.getElementById("imgLinkInput").value || "";
    const video = document.getElementById("videoLinkInput").value || "";
    const timestamp = new Date().toLocaleString("en-GB", { timeZone:"Africa/Nairobi" });

    const body = JSON.stringify({
      values: [[timestamp, title, desc, font, color, bgColor, anim, image, video]]
    });

    try {
      const res = await fetch(
        "https://sheets.googleapis.com/v4/spreadsheets/1wxKcMGMrxSIsiqOWaqKlHAwKj_qaNP3HxSBpu67hKHA/values/pages:append?valueInputOption=USER_ENTERED&key=AIzaSyDtgJrmygEsN6xkvw5UHSwjizgH9Ii_eSc",
        { method:"POST", headers:{"Content-Type":"application/json"}, body }
      );

      if (res.ok) {
        alert("Page saved successfully!");
        window.location.reload();
      } else {
        const err = await res.json().catch(() => ({ error:{ status: res.status, message:"Non-JSON response" }}));
        console.error("Google API Save Error:", err);
        alert("Failed to save: " + (err.error?.message || `HTTP ${res.status}`));
      }
    } catch (e) {
      console.error("Unexpected Save Error:", e);
      alert("Error occurred while saving â€” check console");
    }
  }
</script>
</body>
</html>
